-- TP2

CREATE TABLE ARTICLE (
    ID INT PRIMARY KEY,
    REF VARCHAR(120),
    DESIGNATION VARCHAR(120),
    PRIX DECIMAL(5,2),
    ID_FOU INT FOREIGN KEY
);

CREATE TABLE FOURNISSEUR (
    ID INT PRIMARY KEY,
    NOM VARCHAR(120)
);

CREATE TABLE BON (
    ID INT PRIMARY KEY,
    NUMERO VARCHAR(120),
    DATE_COMMANDE DATE,
    DELAI INT, -- TIME
    ID_FOU INT FOREIGN KEY
);

CREATE TABLE COMPO (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    QTE INT,
    ID_ART INT FOREIGN KEY,
    ID_BON INT FOREIGN KEY
);

ALTER TABLE ARTICLE ADD CONSTRAINT FK_ARTICLE_1 FOREIGN KEY (ID_FOU) REFERENCES FOURNISSEUR(ID);
ALTER TABLE BON ADD CONSTRAINT FK_BON_1 FOREIGN KEY (ID_FOU) REFERENCES FOURNISSEUR(ID);
ALTER TABLE COMPO ADD CONSTRAINT FK_ARTICLE_2 FOREIGN KEY (ID_ART) REFERENCES ARTICLE(ID);
ALTER TABLE COMPO ADD CONSTRAINT FK_BON_2 FOREIGN KEY (ID_BON) REFERENCES BON(ID);


-- TP3

INSERT INTO FOURNISSEUR (ID, NOM) values ('1', 'Française d’Imports');
INSERT INTO FOURNISSEUR (ID, NOM) values ('2', 'FDM SA');
INSERT INTO FOURNISSEUR (ID, NOM) values ('3', 'Dubois & Fils');

INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('1', 'A01', 'Perceuse P1', 74.99, 1);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('2', 'F01', 'Boulon laiton 4 x 40 mm (sachet de 10)', 2.25, 2);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('3', 'F02', 'Boulon laiton 5 x 40 mm (sachet de 10)', 4.45, 2);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('4', 'D01', 'Boulon laiton 5 x 40 mm (sachet de 10)', 4.40, 3);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('5', 'A02', 'Meuleuse 125mm', 37.85, 1);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('6', 'D03', 'Boulon acier zingué 4 x 40mm (sachet de 10)', 1.8, 3);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('7', 'A03', 'Perceuse à colonne', 185.25, 1);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('8', 'D04', 'Coffret mêches à bois', 12.25, 3);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('9', 'F03', 'Coffret mêches plates', 6.25, 2);
INSERT INTO ARTICLE (ID, REF, DESIGNATION, PRIX, ID_FOU) values ('10', 'F04', 'Fraises d’encastrement', 8.14, 2);

-- creation bon et compositions
INSERT INTO BON (ID, NUMERO, DATE_COMMANDE, DELAI, ID_FOU) values ('1', '01234', '2023-05-24', 3, 2);

INSERT INTO COMPO (QTE, ID_ART, ID_BON) values (3, 1, 1);
INSERT INTO COMPO (QTE, ID_ART, ID_BON) values (4, 5, 1);
INSERT INTO COMPO (QTE, ID_ART, ID_BON) values (1, 7, 1);

-- TP4

SELECT * FROM ARTICLE;
SELECT * FROM ARTICLE A WHERE A.PRIX >= 2;
SELECT * FROM ARTICLE A WHERE A.PRIX >= 2 AND A.PRIX <= 6.25;
SELECT * FROM ARTICLE A WHERE A.PRIX BETWEEN 2 AND 6.25;
SELECT * FROM ARTICLE A WHERE A.PRIX NOT BETWEEN 2 AND 6.25;
SELECT * FROM ARTICLE A WHERE A.ID_FOU = 1 OR A.ID_FOU = 3;
SELECT * FROM ARTICLE A WHERE A.ID_FOU IN (1, 3);
SELECT * FROM ARTICLE A WHERE A.ID_FOU NOT IN (1, 3);
SELECT * FROM BON B WHERE B.DATE_COMMANDE BETWEEN '2019-02-01' AND '2019-04-30';

--TP5 optionnel requêtes avancées

SELECT * FROM ARTICLE ORDER BY DESIGNATION;
SELECT * FROM ARTICLE ORDER BY PRIX DESC;
SELECT * FROM ARTICLE A WHERE A.DESIGNATION LIKE 'Boulon%' ORDER BY PRIX ASC;
SELECT * FROM ARTICLE A WHERE A.DESIGNATION LIKE '%sachet%';
SELECT * FROM ARTICLE A WHERE A.DESIGNATION LIKE '%Sachet%';
SELECT A.*, F.NOM FROM ARTICLE A, FOURNISSEUR F WHERE A.ID_FOU = F.ID ORDER BY F.NOM ASC AND A.PRIX DESC;
SELECT * FROM ARTICLE A INNER JOIN FOURNISSEUR F ON A.ID_FOU = F.ID AND A.ID_FOU = 3;







-- TP6 UPDATE

SET SQL_SAFE_UPDATES = 0;
UPDATE ARTICLE A SET A.DESIGNATION = UPPER(A.DESIGNATION) WHERE PRIX > 10;
UPDATE ARTICLE A SET A.DESIGNATION = LOWER(A.DESIGNATION) WHERE A.ID = 2;
UPDATE ARTICLE A SET A.PRIX = (110/100)* A.PRIX WHERE A.ID_FOU = 2;

-- TP7 SUPPRESSION

DELETE FROM COMPO WHERE IN (SELECT BON B WHERE B.DATE_COMMANDE LIKE '2017%');
-- SELECT C.*, B.* FROM COMPO C, BON B WHERE B.DATE_COMMANDE LIKE '2019-02%' AND C.ID_BON = B.ID;
DELETE FROM COMPO WHERE ID_BON IN (SELECT B.ID FROM BON B WHERE B.DATE_COMMANDE LIKE '2023%' AND C.ID_BON = B.ID);
DELETE FROM BON B WHERE B.DATE_COMMANDE LIKE '2023%';
